timely.define("libs/ajax_fileupload",["jquery_timely"],function(e){var t=function(t,n,r){var i="ajax_fileupload"+(new Date).getTime(),s=e('<iframe name="'+i+'"/>').css({border:"none",width:0,height:0});s.appendTo("body"),s.one("load",function(){var t;if(n==="json")t=e.parseJSON(s.contents().text());else if(n==="xml-json"){var i;typeof (i=s[0].contentWindow.document.XMLDocument)!="undefined"?t=e(i).text():t=s.contents().text(),t=e.parseJSON(t)}else t=s.contents().children();r(t),s.remove()}),t.attr({target:i,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}),t.submit()};return{post:t}}),timely.define("scripts/front_end_create_event_form",["jquery_timely","scripts/add_new_event/event_location/gmaps_helper","libs/select2_multiselect_helper","libs/tags_select","libs/ajax_fileupload","libs/timepicker_helper","ai1ec_config","external_libs/moment","libs/recaptcha","external_libs/Placeholders","external_libs/bootstrap/collapse","external_libs/bootstrap/alert","external_libs/bootstrap_datepicker","external_libs/bootstrap_fileupload","external_libs/jquery.scrollTo"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h=function(){var t=e("#ai1ec-create-event-modal");t.appendTo("body"),t.modal({show:!1}).one("show.bs.modal",function(){e(".ai1ec-ajax-placeholder",this).load(o.ajax_url+"?action=ai1ec_front_end_create_event_form",function(){e(".ai1ec-loading",t).removeClass("ai1ec-show"),f=e(".ai1ec-create-event-form"),l=f.parent(),c=l.siblings(".ai1ec-loading"),p(),S()})}).on("show.bs.modal",function(){typeof f!="undefined"&&a.init_recaptcha()}).on("hidden.bs.modal",function(t){e(".ai1ec-recaptcha",this).removeClass("ai1ec-initializing ai1ec-initialized"),e(".ai1ec-modal-backdrop").remove(),Recaptcha.destroy()}),t.on("show hidden",".ai1ec-collapse",function(e){e.stopPropagation()})},p=function(){o.disable_autocompletion||timely.require(["libs/gmaps"],function(e){e(t.init_gmaps)}),e("#open_require_disclaimer").on("click",function(t){e("#require_disclaimer").is(":checked")&&(t.preventDefault(),t.stopImmediatePropagation(),e("#show_disclaimer").hasClass("ai1ec-in")?e("#show_disclaimer").collapse("hide"):e("#show_disclaimer").collapse("show"))}),e(".ai1ec-datepicker",f).datepicker({autoclose:!0,todayHighlight:!0}).each(function(){e(this).data("datepicker").picker.wrapAll('<div class="timely">')}),s.init(f),n.init(f),r.init(f),a.init_recaptcha(f),e(".ai1ec-alert",f).alert(),window.setTimeout(function(){e(':input[type!="hidden"]:first',f).focus()},350)},d=function(){e("#recaptcha_response_field",f).length&&typeof Recaptcha!="undefined"&&Recaptcha.reload(),e(".ai1ec-modal-body",f).scrollTo(".ai1ec-alert:first",1e3)},v=function(){this.checked?(e("#ai1ec-end-time-input-wrap",f).collapse("show"),e("#ai1ec-has-end-time ~ .ai1ec-without-time",f).hide(),e("#ai1ec-has-end-time ~ .ai1ec-with-time",f).show()):(e("#ai1ec-end-time-input-wrap",f).collapse("hide"),e("#ai1ec-has-end-time ~ .ai1ec-without-time",f).show(),e("#ai1ec-has-end-time ~ .ai1ec-with-time",f).hide()),y()},m=function(){var t=!0,n=e("#ai1ec-has-end-time",f).is(":checked");return $require_disc=e("#require_disclaimer"),$required=e("#ai1ec-event-title, #ai1ec-start-date-input, #recaptcha_response_field",f),$required.add("[required=true]",f),n&&($required=$required.add("#ai1ec-end-date-input",f)),e(".ai1ec-alert-danger",f).addClass("ai1ec-hide"),$require_disc.length>0&&!$require_disc.is(":checked")&&(t=!1,e(".ai1ec-required-disclaimer",f).removeClass("ai1ec-hide")),$required.each(function(){var n=e(this),r=n.val();if(""===r||n.attr("placeholder")===r)return t=!1,e(".ai1ec-missing-field",f).find("em").text(n.attr("placeholder")).end().removeClass("ai1ec-hide"),n.focus(),!1}),t},g=function(){var t=e("#ai1ec-start-date-input",f),n=e("#ai1ec-end-date-input",f),r=e("#ai1ec-start-time-input",f),i=e("#ai1ec-end-time-input",f),s=e("#ai1ec-has-time",f)[0].checked,o=t.val(),a=r.val(),l=n.val(),c=i.val(),h="",p="",d,v,m,g=f.data("ai1ecStartTime"),y=f.data("ai1ecEndTime"),b=!1;typeof g=="undefined"&&(g=""),typeof y=="undefined"&&(y=""),d=t.data("dateFormat").toUpperCase(),r.data("showMeridian")?v="hh:mm A":v="HH:mm",m=d+" "+v,o!==""&&(s&&a!==""?h=u.utc(o+" "+a,m):h=u.utc(o,d),h=h.unix()),h===""||g!==""&&parseInt(g,10)===h?l!==""&&(s&&c!==""?p=u.utc(l+" "+c,m):p=u.utc(l,d),p=p.unix(),p<h&&(p=h,b=!0)):(g===""?g=h:g=parseInt(g,10),y===""?y=g:y=parseInt(y,10),p=h+y-g,b=!0);if(b){var w=u.unix(p).utc();n.val(w.format(d)).datepicker("update").datepicker("setStartDate",o),s&&a!==""&&i.val(w.format(v))}f.data("ai1ecStartTime",h),f.data("ai1ecEndTime",p)},y=function(){var t=e("#ai1ec-has-time",f)[0].checked,n=e("#ai1ec-has-end-time",f)[0].checked;e("#ai1ec-start-time-input",f).attr("disabled",!t),e("#ai1ec-end-date-input",f).attr("disabled",!n),e("#ai1ec-end-time-input",f).attr("disabled",!t||!n),g()},b=function(t){t.preventDefault();if(!m()){d();return}var n=f.data("ai1ecStartTime"),r=f.data("ai1ecEndTime"),s=e("#ai1ec-has-time",f)[0].checked&&e("#ai1ec-start-time-input",f).val()!=="",a=e("#ai1ec-has-end-time",f)[0].checked;s?a||(r=""):(a||(r=n),r=u.unix(r).add("d",1).unix(),a=!0),n-=3600*o.blog_timezone,r-=3600*o.blog_timezone,e("#ai1ec-start-time",f).val(n),e("#ai1ec-end-time",f).val(r),e("#ai1ec-all-day-event",f).val(s?"":"1"),e("#ai1ec-instant-event",f).val(a?"":"1"),c.addClass("ai1ec-show"),i.post(f,"xml-json",function(t){t.error?(e(".ai1ec-submit-error",f).text(t.message).removeClass("ai1ec-hide"),d()):l.html(t.html),c.removeClass("ai1ec-show")})},w=function(t){t.preventDefault(),c.addClass("ai1ec-show"),l.load(o.ajax_url+"?action=ai1ec_front_end_create_event_form",function(){f=e(".ai1ec-create-event-form",l),p(),c.removeClass("ai1ec-show")})},E=function(t){var n=o.label_buy_tickets_url;this.checked&&(n=o.label_rsvp_url),e("#ai1ec_ticket_url",f).attr("placeholder",n)},S=function(){l.on("click","#ai1ec-has-time",v),l.on("change","#ai1ec_is_free",E),l.on("click","#ai1ec-has-end-time",y),l.on("changeDate",".ai1ec-datepicker",function(){g(),e("#ai1ec-has-time, #ai1ec-has-end-time",f).removeAttr("disabled")}),l.on("change",".ai1ec-timepicker",g),l.on("keyup","#ai1ec_address",function(){var t=e("#ai1ec-google-map",f);this.value===""?(t[0].checked&&t.click(),t.attr("disabled","disabled")):t.removeAttr("disabled")}),l.on("click",".ai1ec-submit",b),l.on("click",".ai1ec-post-another",w)},x=function(){h()},T=function(){a.init_recaptcha(f)};return{start:x}}),timely.require(["scripts/front_end_create_event_form"],function(e){e.start()}),timely.define("pages/front_end_create_event_form",function(){});